!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.returnExportsGlobal=t()}):"object"==typeof exports?module.exports=t():e.Formatter=t()}(this,function(){var e=navigator.userAgent.toLowerCase(),t=-1!==e.indexOf("android"),n=-1!==e.indexOf("chrome"),r=function(){var e={},t=4,n=new RegExp("{{([^}]+)}}","g"),r=function(e){for(var t,r=[];t=n.exec(e);)r.push(t);return r};return e.parse=function(e){var n={inpts:{},chars:{}},s=r(e),i=e.length,a=0,o=0,h=0,l=function(e){for(var r=e.length,s=0;r>s;s++)n.inpts[o]=e.charAt(s),o++;a++,h+=e.length+t-1};for(h;i>h;h++)a<s.length&&h===s[a].index?l(s[a][1]):n.chars[h-a*t]=e.charAt(h);return n.mLength=h-a*t,n},e}(),s=function(){{var e={};"undefined"!=typeof navigator?navigator.userAgent:null}return e.extend=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])e[n]=arguments[t][n];return e},e.addChars=function(e,t,n){return e.substr(0,n)+t+e.substr(n,e.length)},e.removeChars=function(e,t,n){return e.substr(0,t)+e.substr(n,e.length)},e.isBetween=function(e,t){return t.sort(function(e,t){return e-t}),e>t[0]&&e<t[1]},e.addListener=function(e,t,n){return"undefined"!=typeof e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},e.preventDefault=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1},e.getClip=function(e){return!e.clipboardData||n&&t?window.clipboardData?window.clipboardData.getData("Text"):null:e.clipboardData.getData("Text")},e.getMatchingKey=function(e,t,n){for(var r in n){var s=n[r];if(e===s.which&&t===s.keyCode)return r}},e.isDelKeyDown=function(t,n){var r={backspace:{which:8,keyCode:8},"delete":{which:46,keyCode:46}};return e.getMatchingKey(t,n,r)},e.isDelKeyPress=function(t,n){var r={backspace:{which:8,keyCode:8,shiftKey:!1},"delete":{which:0,keyCode:46}};return e.getMatchingKey(t,n,r)},e.isSpecialKeyPress=function(t,n){var r={tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40},F5:{which:0,keyCode:116}};return e.getMatchingKey(t,n,r)},e.isModifier=function(e){return e.ctrlKey||e.altKey||e.metaKey},e.forEach=function(e,t,n){if(e.hasOwnProperty("length"))for(var r=0,s=e.length;s>r&&t.call(n,e[r],r,e)!==!1;r++);else for(var i in e)if(e.hasOwnProperty(i)&&t.call(n,e[i],i,e)===!1)break},e}(),i=function(e,t){function n(n){var s=[],i=[];t.forEach(n,function(n){t.forEach(n,function(t,n){var a=e.parse(t),o=r(n);return s.push(o),i.push(a),!1})});var a=function(e){var n;return t.forEach(s,function(t,r){return t.test(e)?(n=r,!1):void 0}),void 0===n?null:i[n]};return{getPattern:a,patterns:i,matchers:s}}var r=function(e){return"*"===e?/.*/:new RegExp(e)};return n}(r,s),a=function(){var e={};return e.get=function(e){if("number"==typeof e.selectionStart)return{begin:e.selectionStart,end:e.selectionEnd};var t=document.selection.createRange();if(t&&t.parentElement()===e){var n=e.createTextRange(),r=e.createTextRange(),s=e.value.length;return n.moveToBookmark(t.getBookmark()),r.collapse(!1),n.compareEndPoints("StartToEnd",r)>-1?{begin:s,end:s}:{begin:-n.moveStart("character",-s),end:-n.moveEnd("character",-s)}}return{begin:0,end:0}},e.set=function(e,t){if("object"!=typeof t&&(t={begin:t,end:t}),e.setSelectionRange)e.focus(),e.setSelectionRange(t.begin,t.end);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t.end),n.moveStart("character",t.begin),n.select()}},e}(),o=function(e,t,n){function r(t,r){var i=this;if(i.el=t,!i.el)throw new TypeError("Must provide an existing element");if(i.opts=n.extend({},s,r),"undefined"!=typeof i.opts.pattern&&(i.opts.patterns=i._specFromSinglePattern(i.opts.pattern),delete i.opts.pattern),"undefined"==typeof i.opts.patterns)throw new TypeError("Must provide a pattern or array of patterns");i.patternMatcher=e(i.opts.patterns),i._updatePattern(),i.hldrs={},i.focus=0,n.addListener(i.el,"keydown",function(e){i._keyDown(e)}),n.addListener(i.el,"keypress",function(e){i._keyPress(e)}),n.addListener(i.el,"paste",function(e){i._paste(e)}),i.opts.persistent&&(i._processKey("",!1),i.el.blur(),n.addListener(i.el,"focus",function(e){i._focus(e)}),n.addListener(i.el,"click",function(e){i._focus(e)}),n.addListener(i.el,"touchstart",function(e){i._focus(e)}))}var s={persistent:!1,repeat:!1,placeholder:" "},i={9:/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};return r.addInptType=function(e,t){i[e]=t},r.prototype.resetPattern=function(n){this.opts.patterns=n?this._specFromSinglePattern(n):this.opts.patterns,this.sel=t.get(this.el),this.val=this.el.value,this.delta=0,this._removeChars(),this.patternMatcher=e(this.opts.patterns);var r=this.patternMatcher.getPattern(this.val);this.mLength=r.mLength,this.chars=r.chars,this.inpts=r.inpts,this._processKey("",!1,!0)},r.prototype._updatePattern=function(){var e=this.patternMatcher.getPattern(this.val);e&&(this.mLength=e.mLength,this.chars=e.chars,this.inpts=e.inpts)},r.prototype._keyDown=function(e){var t=e.which||e.keyCode;return t&&n.isDelKeyDown(e.which,e.keyCode)?(this._processKey(null,t),n.preventDefault(e)):void 0},r.prototype._keyPress=function(e){var t,r;return t=e.which||e.keyCode,r=n.isSpecialKeyPress(e.which,e.keyCode),n.isDelKeyPress(e.which,e.keyCode)||r||n.isModifier(e)?void 0:(this._processKey(String.fromCharCode(t),!1),n.preventDefault(e))},r.prototype._paste=function(e){var t=n.getClip(e);if(null!=t)return this._processKey(t,!1),n.preventDefault(e);var r=this;window.setTimeout(function(){r._processKey("",!1,!0)},0)},r.prototype._focus=function(){var e=this;setTimeout(function(){var n=t.get(e.el),r=n.end>e.focus,s=0===n.end;(r||s)&&t.set(e.el,e.focus)},0)},r.prototype._processKey=function(e,r,s){if(this.sel=t.get(this.el),this.val=this.el.value,this.delta=0,this.sel.begin!==this.sel.end)this.delta=-1*Math.abs(this.sel.begin-this.sel.end),this.val=n.removeChars(this.val,this.sel.begin,this.sel.end);else if(r&&46===r)this._delete();else if(r&&this.sel.begin-1>=0)this.val=n.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta-=1;else if(r)return!0;r||(this.val=n.addChars(this.val,e,this.sel.begin),this.delta+=e.length),this._formatValue(s)},r.prototype._delete=function(){for(;this.chars[this.sel.begin];)this._nextPos();this.sel.begin<this.val.length&&(this._nextPos(),this.val=n.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta=-1)},r.prototype._nextPos=function(){this.sel.end++,this.sel.begin++},r.prototype._formatValue=function(e){this.newPos=this.sel.end+this.delta,this._removeChars(),this._updatePattern(),this._validateInpts(),this._addChars(),this.el.value=this.val.substr(0,this.mLength),("undefined"==typeof e||e===!1)&&t.set(this.el,this.newPos)},r.prototype._removeChars=function(){this.sel.end>this.focus&&(this.delta+=this.sel.end-this.focus);for(var e=0,t=0;t<=this.mLength;t++){var r,s=this.chars[t],i=this.hldrs[t],a=t+e;a=t>=this.sel.begin?a+this.delta:a,r=this.val.charAt(a),(s&&s===r||i&&i===r)&&(this.val=n.removeChars(this.val,a,a+1),e--)}this.hldrs={},this.focus=this.val.length},r.prototype._validateInpts=function(){for(var e=0;e<this.val.length;e++){var t=this.inpts[e],r=!i[t],s=!r&&!i[t].test(this.val.charAt(e)),a=this.inpts[e];(r||s)&&a&&(this.val=n.removeChars(this.val,e,e+1),this.focusStart--,this.newPos--,this.delta--,e--)}},r.prototype._addChars=function(){if(this.opts.persistent){for(var e=0;e<=this.mLength;e++)this.val.charAt(e)||(this.val=n.addChars(this.val,this.opts.placeholder,e),this.hldrs[e]=this.opts.placeholder),this._addChar(e);for(;this.chars[this.focus];)this.focus++}else for(var t=0;t<=this.val.length;t++){if(this.delta<=0&&t===this.focus)return!0;this._addChar(t)}},r.prototype._addChar=function(e){var t=this.chars[e];return t?(n.isBetween(e,[this.sel.begin-1,this.newPos+1])&&(this.newPos++,this.delta++),e<=this.focus&&this.focus++,this.hldrs[e]&&(delete this.hldrs[e],this.hldrs[e+1]=this.opts.placeholder),void(this.val=n.addChars(this.val,t,e))):!0},r.prototype._specFromSinglePattern=function(e){return[{"*":e}]},r}(i,a,s);return o}),Formatter.isBrowserCompatible=function(){var e=navigator.userAgent.toLowerCase(),t=-1!==e.indexOf("android"),n=-1!==e.indexOf("firefox/"),r=-1!==e.indexOf("chrome"),s=-1!==e.indexOf("iemobile"),i=-1!==e.indexOf("windows phone"),a=0;r&&(a=parseInt(window.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10));var o=-1!==e.indexOf("opera mobi/"),h=!(o||t&&n||t&&r&&38>a||s&&i);return h};